#!/usr/bin/env bash
# vim: filetype=sh
set -euo pipefail

source $DOTFILES/scripts/core/main.sh 

##? Healthcheck
 #? 0.1.0
##?
##? Usage:
##?    health

eval_docopts "$@"

CODE=0

function check_command_available() {
  local cmd="$1"
  if command_exists "$cmd"; then
    success "$cmd"
  else
    error "$cmd"
    CODE=$(($CODE + 1))
  fi
}

function check_gnu_command_available() {
  local cmd
  if is_osx; then
    cmd="g$1"
  else
    cmd="$1"
  fi
  check_command_available "$cmd"
}

function check() {
  local cmds="$1"
  local gnu="${2:-false}"
  for cmd in $cmds; do
    if $gnu; then
      check_gnu_command_available "$cmd"
    else
      check_command_available "$cmd"
    fi
  done
}

header "Can find required commands?"
check "git zsh tmux nvim fasd ruby python ag"

echo
header "Can find gnu commands?"
check "sed grep" true

exit $CODE